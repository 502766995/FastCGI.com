<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0089)https://web.archive.org/web/20130306092439/http://www.fastcgi.com/drupal/node/6?q=node/24 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><script type="text/javascript">window["_gaUserPrefs"] = { ioo : function() { return true; } }</script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<style>#content > #right > .dose > .dosesingle,
#content > #center > .dose > .dosesingle
{display:none !important;}</style><script type="text/javascript" src="https://web.archive.org/static/js/analytics.js"></script>
<script type="text/javascript">archive_analytics.values.server_name="wwwb-app6.us.archive.org";archive_analytics.values.server_ms=203;</script>
<link type="text/css" rel="stylesheet" href="./The Apache FastCGI Process Manager _ FastCGI -_files/banner-styles.css">


<title>The Apache FastCGI Process Manager | FastCGI - </title>

<link type="text/css" rel="stylesheet" media="all" href="./The Apache FastCGI Process Manager _ FastCGI -_files/node.css">
<link type="text/css" rel="stylesheet" media="all" href="./The Apache FastCGI Process Manager _ FastCGI -_files/defaults.css">
<link type="text/css" rel="stylesheet" media="all" href="./The Apache FastCGI Process Manager _ FastCGI -_files/system.css">
<link type="text/css" rel="stylesheet" media="all" href="./The Apache FastCGI Process Manager _ FastCGI -_files/system-menus.css">
<link type="text/css" rel="stylesheet" media="all" href="./The Apache FastCGI Process Manager _ FastCGI -_files/user.css">
<link type="text/css" rel="stylesheet" media="all" href="./The Apache FastCGI Process Manager _ FastCGI -_files/style.css">
</head>
<body><div id="wm-ipp" lang="en" style="display: block;" class="">

<div style="position:fixed;left:0;top:0;width:100%!important">
<div id="wm-ipp-inside">
   <table style="width:100%;"><tbody><tr>
   <td id="wm-logo">
       <a href="https://web.archive.org/web/" title="Wayback Machine home page"><img src="./The Apache FastCGI Process Manager _ FastCGI -_files/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"></a>
   </td>
   <td class="c">
       <table style="margin:0 auto;"><tbody><tr>
       <td class="u" colspan="2">
       <form target="_top" method="get" action="https://web.archive.org/web/form-submit.jsp" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://www.fastcgi.com/drupal/node/6?q=node/24" style="width:400px;" onfocus="this.focus();this.select();"><input type="hidden" name="type" value="replay"><input type="hidden" name="date" value="20130306092439"><input type="submit" value="Go"><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td class="n" rowspan="2">
           <table><tbody>
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr class="m">
           	<td class="b" nowrap="nowrap">
		
		    <a href="https://web.archive.org/web/20130123131643/http://www.fastcgi.com/drupal/node/6?q=node/24" title="23 janv. 2013">JANV.</a>
		
		</td>
		<td class="c" id="displayMonthEl" title="You are here: 9:24:39 mars 6, 2013">mars</td>
		<td class="f" nowrap="nowrap">
		
		    <a href="https://web.archive.org/web/20150208033411/http://www.fastcgi.com/drupal/node/6?q=node/24" title="8 févr. 2015"><strong>FÉVR.</strong></a>
		
                </td>
	    </tr>
           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr class="d">
               <td class="b" nowrap="nowrap">
               
                   <a href="https://web.archive.org/web/20130123131643/http://www.fastcgi.com/drupal/node/6?q=node/24" title="13:16:43 janv. 23, 2013"><img src="./The Apache FastCGI Process Manager _ FastCGI -_files/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0"></a>
               
               </td>
               <td class="c" id="displayDayEl" style="width:34px;font-size:24px;" title="You are here: 9:24:39 mars 6, 2013">6</td>
	       <td class="f" nowrap="nowrap">
               
		   <a href="https://web.archive.org/web/20150208033411/http://www.fastcgi.com/drupal/node/6?q=node/24" title="3:34:11 févr. 8, 2015"><img src="./The Apache FastCGI Process Manager _ FastCGI -_files/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"></a>
	       
	       </td>
           </tr>
           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr class="y">
	       <td class="b" nowrap="nowrap">
               
                   <a href="https://web.archive.org/web/20120207224150/http://www.fastcgi.com/drupal/node/6?q=node/24" title="7 févr. 2012"><strong>2012</strong></a>
               
               </td>
               <td class="c" id="displayYearEl" title="You are here: 9:24:39 mars 6, 2013">2013</td>
	       <td class="f" nowrap="nowrap">
               
	           <a href="https://web.archive.org/web/20150208033411/http://www.fastcgi.com/drupal/node/6?q=node/24" title="8 févr. 2015"><strong>2015</strong></a>
	       
	       </td>
           </tr>
           </tbody></table>
       </td>
       </tr>
       <tr>
       <td class="s">
           <a class="t" href="https://web.archive.org/web/20130306092439*/http://www.fastcgi.com/drupal/node/6?q=node/24" title="See a list of every capture for this URL">29 captures</a>
           <div class="r" title="Timespan for captures of this URL">23 janv. 09 - 5 mars 16</div>
       </td>
       <td class="k">
       <a href="https://web.archive.org/web/20120901000000/http://www.fastcgi.com/drupal/node/6?q=node/24" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" title="Explore captures for this URL">
	 <img id="sparklineImgId" alt="sparklines" onmouseover="__wm.st(1)" onmouseout="__wm.st(0)" onmousemove="__wm.mv(event,this)" width="525" height="27" border="0" src="./The Apache FastCGI Process Manager _ FastCGI -_files/graph.jsp">
       <div class="yt" style="display: none; width: 25px; height: 27px; left: 400px;"></div><div class="mt" style="display: none; width: 2px; height: 27px; left: 417px;"></div></div>
       </a>
       </td>
       </tr></tbody></table>
   </td>
   <td class="r">
       <a href="https://web.archive.org/web/20130306092439/http://www.fastcgi.com/drupal/node/6?q=node/24#close" onclick="__wm.h();return false;" style="background-image:url(/static/images/toolbar/wm_tb_close.png);top:5px;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="background-image:url(/static/images/toolbar/wm_tb_help.png);bottom:5px;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>
</div>
</div>
</div>


<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script type="text/javascript" src="./The Apache FastCGI Process Manager _ FastCGI -_files/disclaim-element.js"></script>
<script type="text/javascript" src="./The Apache FastCGI Process Manager _ FastCGI -_files/graph-calc.js"></script>
<script type="text/javascript">//<![CDATA[
var __wm = (function(imgWidth,imgHeight,yearImgWidth,monthImgWidth){
var wbPrefix = "/web/";
var wbCurrentUrl = "http://www.fastcgi.com/drupal/node/6?q=node/24";

var firstYear = 1996;
var displayDay = "6";
var displayMonth = "mars";
var displayYear = "2013";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var $D=document,$=function(n){return document.getElementById(n)};
var trackerVal,curYear = -1,curMonth = -1;
var yearTracker,monthTracker;
function showTrackers(val) {
  if (val===trackerVal) return;
  var $ipp=$("wm-ipp");
  var $y=$("displayYearEl"),$m=$("displayMonthEl"),$d=$("displayDayEl");
  if (val) {
    $ipp.className="hi";
  } else {
    $ipp.className="";
    $y.innerHTML=displayYear;$m.innerHTML=displayMonth;$d.innerHTML=displayDay;
  }
  yearTracker.style.display=val?"inline":"none";
  monthTracker.style.display=val?"inline":"none";
  trackerVal = val;
}
function trackMouseMove(event,element) {
  var eventX = getEventX(event);
  var elementX = getElementX(element);
  var xOff = Math.min(Math.max(0, eventX - elementX),imgWidth);
  var monthOff = xOff % yearImgWidth;

  var year = Math.floor(xOff / yearImgWidth);
  var monthOfYear = Math.min(11,Math.floor(monthOff / monthImgWidth));
  // 1 extra border pixel at the left edge of the year:
  var month = (year * 12) + monthOfYear;
  var day = monthOff % 2==1?15:1;
  var dateString = zeroPad(year + firstYear) + zeroPad(monthOfYear+1,2) +
    zeroPad(day,2) + "000000";

  $("displayYearEl").innerHTML=year+firstYear;
  $("displayMonthEl").innerHTML=prettyMonths[monthOfYear];
  // looks too jarring when it changes..
  //$("displayDayEl").innerHTML=zeroPad(day,2);
  var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
  $("wm-graph-anchor").href=url;

  if(curYear != year) {
    var yrOff = year * yearImgWidth;
    yearTracker.style.left = yrOff + "px";
    curYear = year;
  }
  if(curMonth != month) {
    var mtOff = year + (month * monthImgWidth) + 1;
    monthTracker.style.left = mtOff + "px";
    curMonth = month;
  }
}
function hideToolbar() {
  $("wm-ipp").style.display="none";
}
function bootstrap() {
  var $spk=$("wm-ipp-sparkline");
  yearTracker=$D.createElement('div');
  yearTracker.className='yt';
  with(yearTracker.style){
    display='none';width=yearImgWidth+"px";height=imgHeight+"px";
  }
  monthTracker=$D.createElement('div');
  monthTracker.className='mt';
  with(monthTracker.style){
    display='none';width=monthImgWidth+"px";height=imgHeight+"px";
  }
  $spk.appendChild(yearTracker);
  $spk.appendChild(monthTracker);

  var $ipp=$("wm-ipp");
  $ipp&&disclaimElement($ipp);
}
return{st:showTrackers,mv:trackMouseMove,h:hideToolbar,bt:bootstrap};
})(525, 27, 25, 2);//]]>
</script>
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  min-width:800px !important;
}
</style>

<script type="text/javascript">__wm.bt();</script>
<!-- END WAYBACK TOOLBAR INSERT -->





<div id="wrapper">
	<div id="logo"></div>
	<div id="nav">
		<ul class="nav-links primary-nav-links"><li class="menu-49 first"><a href="https://web.archive.org/web/20130306092439/http://www.fastcgi.com/drupal/node/2">FastCGI</a></li>
<li class="menu-53"><a href="https://web.archive.org/web/20130306092439/http://www.fastcgi.com/drupal/node/19">News</a></li>
<li class="menu-45"><a href="https://web.archive.org/web/20130306092439/http://www.fastcgi.com/drupal/node/6">Documentation</a></li>
<li class="menu-44"><a href="https://web.archive.org/web/20130306092439/http://www.fastcgi.com/drupal/node/5">API/Libraries</a></li>
<li class="menu-43"><a href="https://web.archive.org/web/20130306092439/http://www.fastcgi.com/drupal/node/3">FastCGI Servers</a></li>
<li class="menu-46"><a href="https://web.archive.org/web/20130306092439/http://www.fastcgi.com/drupal/node/7">Misc.</a></li>
<li class="menu-48"><a href="https://web.archive.org/web/20130306092439/http://www.fastcgi.com/drupal/node/12">Help!</a></li>
<li class="menu-47 last"><a href="https://web.archive.org/web/20130306092439/http://www.fastcgi.com/drupal/node/8">About Us</a></li>
</ul>		</div>
	<div id="heading">
		The Apache FastCGI Process Manager	</div> <!-- end heading -->
	<div id="content">
												<div id="node-24" class="node">



  
  <div class="content">
    

   
   <meta name="Author" content="Stanley Gambarin">
   <meta name="GENERATOR" content="Mozilla/4.01 [en] (Win95; I) [Netscape]">
   <meta name="Description" content="Description of the role of the process manager in the processing of the
FastCGI requests in the Apache web server.">
   <title>FastCGI process manager for Apache web server</title>



<h1>FastCGI process manager for Apache web server.</h1>
<h3><i>What is the process manager?</i></h3>


<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The process manager is an
executable program that is responsible for controlling the execution of
the FastCGI applications.&nbsp; The control is accomplished through starting&nbsp;
the applications, restarting them if they have terminated for some reason
and deciding when the FastCGI application should no longer run, as in the
case of dynamically started FastCGI apps.
<br>&nbsp;

</p><h3>
<i>Why is it needed ?</i></h3>


<p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The FastCGI protocol depends
on the persistent applications being run during the web server execution
to handle incoming HTTP requests.&nbsp; In most cases these persistent
applications must be started prior to serving any requests forwarded to
them by the web server (an exception are the dynamically started FastCGI
applications).&nbsp; Should an application die during processing, it should
be immediately restarted, so that it handle the next request.&nbsp; It
is the job of the process manager to maintain this control over the execution
of the FastCGI applications.
<br>&nbsp;
</p><h3>
<i>What is going on when the webserver starts ?</i></h3>


<p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When the web server reads
its configuration files and encounters a directive in which a certain module
maybe interested in, it calls a&nbsp; corresponding function in that module
to handle the processing of the directive.&nbsp; In FastCGI module mod_fastcgi,
these directives (AppClass and ExternalAppClass) are used to specify what
FastCGI applications should be started/restarted by the process manager
in order to handle incoming requests.&nbsp; After the web serve has finished
reading its configuration files, a process manager process is executed,
which in turn executes all preconfigured FastCGI applications, so that
they can begin accepting requests.&nbsp; The process manager then enters
an infinite loop until the time that the web server has informed it [process
manager] about the termination, at which time the process manager's duties
include terminating all child processes (FastCGI applications), freeing
up any used resources, such as memory, file descriptors, etc. and terminating.
<br>&nbsp;
</p><h3>
<i>How does the process manager interact with the dynamically started FastCGI
applications ?</i></h3>

<p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Some of the process manager
functionality has been changed to accomodate the dynamically created FastCGI
processes, i.e. the processes that do not need to be configured using the
AppClass directive, but are started on their first invokation just like
CGI.&nbsp; Since the process manager has no prior information about the
name of the FastCGI application executable that needs to be created, it
has to obtain that information from somewhere.&nbsp; However, only the
web server knows the name of the FastCGI executable from the HTTP request
line, so it puts an information into a file and signals the process manager
to create the given FastCGI applications.&nbsp; It is important to note
that locking is needed to avoid multiple web server processes writing information
into the file at the same time, causing unpredictable behavior.

</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Once the process manager
obtains the name of the FastCGI executable from the file, it creates it
and treats it just like any other preconfigured FastCGI application.&nbsp;
An important exception is that the dynamically started applications will
NOT be restarted, since they may be faulty and we do not want them to run
or the process manager has decided that they should be terminated and so
it should not attempt to restart them (see below).&nbsp; The process manager
only created one copy of the given FastCGI application as it is not aware
of how "popular" this application is or will be.&nbsp; Therefore, it needs
to perform some data analysis to decide whether another copy of the applications
should be started or whether an application has too many instances running
and one of them should be terminated or whether all of them should be terminated.&nbsp;

The data to be analyzed comed via the same file mechanism from the web
server processes.

</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Since there are many web
server processes and only one process manager, the data processing is done
within the process manager process.&nbsp; This also means that the process
manager is implementing a policy, be deciding which FastCGI applications
should have another instance created and which should have their instances
terminated.&nbsp; The decisions on termination of the FastCGI apps are
made using the following heurisitics (top-level design):
</p><ul>
<li>
given the last time period in which the data analysis was done (which is
specified via -updateInterval option to FCGIConfig), for each dynamically
started FastCGI application, calculate how much of that time was spent
by the application handling the request (the information about it comes
from the web server process that knows when the start and end times of
the request to the FastCGI application).<br>
<br></li>

<li>
since the last data analysis period the web server might have been a spike
of incoming requests or a dead interval after a number of periods of great
activity. As such, you do not want to make your decisions on whether to
terminate the FastCGI application just based on the time interval elapsed
since the last data analysis was performed.&nbsp; Therefore, an exponential
decay was introduced to smooth out the possible spikes in the web server.&nbsp;

The formula for calculating the "new popularity" is:</li>
</ul>

<ul>
<ul>
<li>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>result
= (1-gain)*old_value + gain*new_value;&nbsp; old_value = new_value;</b></li>

<li>
&nbsp;where the old_value is the load of the FastCGI application calculated
during the previous data analysis periods, the new_value is the currently
calculated load factor&nbsp;&nbsp;&nbsp;&nbsp; and the gain is the value
in the range 0..1 specified via -gainValue directive.&nbsp; As one can
see, specifying the gain to be 1 would put more emphasis onto new data
(which is useful if you have very large updateInterval or if you would
like your FastCGI processes to be responsive, so that if many requests
come in, many copies of the FastCGI application are started immediately
and if none come in, many copies of the FastCGI application are to be terminated).&nbsp;

Specifying the value closer to 0 would put a larger emphasis onto old data,
smoothing out the starting and termination of the FastCGI processes.</li>
</ul>
</ul>

<ul>
<li>
once the new "normalized" load factor is calculated using the above formula,
it is compared with the parameters specified via -singleThreshhold and
-multiThreshhold options to the FCGIConfig directive.&nbsp; If the given
FastCGI application has multiple instances of it running and the "normalized"
load factor has fallen below -multiThreshhold, a single instance of that
application is marked to be terminated.&nbsp; If the application has only
a single copy executing and the "normalize" load factor has fallen below
-singleThreshhold, then the only instance is also marked for termination.&nbsp;
Since we would like at least a single copy of the application to be run
(even if it is not very popular), singleThreshhold parameter should be
much much less than multiThreshhold.&nbsp;<br>
<br></li>

<li>
the process manager also does not want to kill off all FastCGI processes
during the long periods of inactivity (say at nighttime), since the cost
of starting a process may be high.&nbsp; A -minProcesses parameter is used
to tell the process manager NOT to mark anymore processes to be terminated
once this minimum is reached just for that case.<br>
<br></li>

<li>
&nbsp;the actual termination of the dynamically started FastCGI processes
takes place later on, which involves some synchornization and locking techniques
to avoid receiving and processing a request by the application that is
about to be terminated.&nbsp; The actual termination is governed by the
-killInterval and -processSlack options to the FCGIConfig directive.&nbsp;
In the normal case, the process manager would perform its killing policy
(just terminating the FastCGI applications that have been marked as victims
during the data analysis stage) every n seconds, where n is the number
specified as a parameter to the -killInterval option.&nbsp; However, it
may come the time that the web servers are very busy servicing a lot of
FastCGI requests.&nbsp; The process manager governs the ceiling on the
total number of dynamically started processes that can be running at any
one time.&nbsp; So, if web server is asking to start a number of the FastCGI
processes, but starting them would exceed the ceiling value, the process
manager needs to implement the killing policy immediately, i.e.&nbsp;<br>

<br></li>

<ul>
<li>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>if (#of
running processes + processSlack &gt; #max processes)&nbsp;&nbsp;&nbsp; do_killing_policy_now();</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br></li>
</ul>
</ul>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The starting of the dynamically
started FastCGI processes is also governed by a few options to the FCGIConfig
directive.&nbsp; After the web server recieves a request for the FastCGI
application, it first determines if the current application has already
been started.&nbsp; It is has not, the web server sends a request to the
process manager, asking it to start the given FastCGI application.&nbsp;

After that the web server attempts to connect to FastCGI applicaton via
connect() system call.&nbsp; The attempt may fail, since the process manager
needs time to process the data and start the corresponding FastCGI application.&nbsp;
To allow for that contingency, a -startDelay option is used to specify
a time interval that the web server is going to wait trying to connect
to the application.&nbsp; If the connection is still unsuccessful, it will
issue another request to start FastCGI application (this is done in case
there are FastCGI application currently running but all of them maybe servicing
requests or server is implementing a killing policy or something else).&nbsp;
The web server keeps repeating its attempts until number of seconds specified
via -appConnTimeout parameter has expired, which is usually an indicator
of either bad configuration (low values for killInterval and very high
load or low value for multiThreshhold, etc) or a bad FastCGI script, where
the process manager is unable to start it.
<br>&nbsp;
<h3>
<i>What does the future hold for the process manager ?</i></h3>


<p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The future enhancements to
the process manager includes complete separation of process manager functionality
from the web server core and providing web-server independent mechanism
of informing the process manager of the important events, such as start/termination
of the web server,&nbsp; configuration file parsing, etc.&nbsp; This would
also aid in porting the process manager functionality to other operating
systems.&nbsp; Finally, an overall redesign may be needed to optimize the
management of the FastCGI applications, possibly using OS-dependent facilities.


</p><p>$Stanley Gambarin &lt;<a href="mailto://stanleyg@cs.bu.edu">stanleyg@cs.bu.edu</a>&gt;
1997/09/27 12:23:23 PM PST$
</p>  </div>

  <div class="clear-block clear">
    <div class="meta">
    
    </div>

      </div>

</div>	</div> <!-- end content -->
	<div id="footer">
		© Copyright 1996 - 2008 Open Market, Rob Saccoccio &amp; others, All rights reserved. <a href="https://web.archive.org/web/20130306092439/http://www.cosmicsitedesign.com/">Web design</a> by CosmicSiteDesign.com
	</div> <!-- end footer -->
</div> <!-- end wrapper -->








<!--
     FILE ARCHIVED ON 9:24:39 mars 6, 2013 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 15:13:12 avr. 10, 2016.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
</body></html>