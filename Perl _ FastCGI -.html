<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0089)https://web.archive.org/web/20110815202714/http://www.fastcgi.com/drupal/node/5?q=node/11 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><script type="text/javascript">window["_gaUserPrefs"] = { ioo : function() { return true; } }</script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<script type="text/javascript" src="https://web.archive.org/static/js/analytics.js"></script><style>#content > #right > .dose > .dosesingle,
#content > #center > .dose > .dosesingle
{display:none !important;}</style>
<script type="text/javascript">archive_analytics.values.server_name="wwwb-app35.us.archive.org";archive_analytics.values.server_ms=288;</script>
<link type="text/css" rel="stylesheet" href="./Perl _ FastCGI -_files/banner-styles.css">


<title>Perl | FastCGI - </title>

<link type="text/css" rel="stylesheet" media="all" href="./Perl _ FastCGI -_files/node.css">
<link type="text/css" rel="stylesheet" media="all" href="./Perl _ FastCGI -_files/defaults.css">
<link type="text/css" rel="stylesheet" media="all" href="./Perl _ FastCGI -_files/system.css">
<link type="text/css" rel="stylesheet" media="all" href="./Perl _ FastCGI -_files/system-menus.css">
<link type="text/css" rel="stylesheet" media="all" href="./Perl _ FastCGI -_files/user.css">
<link type="text/css" rel="stylesheet" media="all" href="./Perl _ FastCGI -_files/style.css">
</head>
<body><div id="wm-ipp" lang="en" style="display: block;" class="">

<div style="position:fixed;left:0;top:0;width:100%!important">
<div id="wm-ipp-inside">
   <table style="width:100%;"><tbody><tr>
   <td id="wm-logo">
       <a href="https://web.archive.org/web/" title="Wayback Machine home page"><img src="./Perl _ FastCGI -_files/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"></a>
   </td>
   <td class="c">
       <table style="margin:0 auto;"><tbody><tr>
       <td class="u" colspan="2">
       <form target="_top" method="get" action="https://web.archive.org/web/form-submit.jsp" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://www.fastcgi.com/drupal/node/5?q=node/11" style="width:400px;" onfocus="this.focus();this.select();"><input type="hidden" name="type" value="replay"><input type="hidden" name="date" value="20110815202714"><input type="submit" value="Go"><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td class="n" rowspan="2">
           <table><tbody>
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr class="m">
           	<td class="b" nowrap="nowrap">
		
		    <a href="https://web.archive.org/web/20110704135855/http://www.fastcgi.com/drupal/node/5?q=node/11" title="4 juil. 2011">JUIL.</a>
		
		</td>
		<td class="c" id="displayMonthEl" title="You are here: 20:27:14 août 15, 2011">août</td>
		<td class="f" nowrap="nowrap">
		
		    <a href="https://web.archive.org/web/20120304145119/http://www.fastcgi.com/drupal/node/5?q=node/11" title="4 mars 2012"><strong>MARS</strong></a>
		
                </td>
	    </tr>
           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr class="d">
               <td class="b" nowrap="nowrap">
               
                   <a href="https://web.archive.org/web/20110725074931/http://www.fastcgi.com/drupal/node/5?q=node/11" title="7:49:31 juil. 25, 2011"><img src="./Perl _ FastCGI -_files/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0"></a>
               
               </td>
               <td class="c" id="displayDayEl" style="width:34px;font-size:24px;" title="You are here: 20:27:14 août 15, 2011">15</td>
	       <td class="f" nowrap="nowrap">
               
		   <a href="https://web.archive.org/web/20120304145119/http://www.fastcgi.com/drupal/node/5?q=node/11" title="14:51:19 mars 4, 2012"><img src="./Perl _ FastCGI -_files/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"></a>
	       
	       </td>
           </tr>
           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr class="y">
	       <td class="b" nowrap="nowrap">
               
                   <a href="https://web.archive.org/web/20091014042951/http://www.fastcgi.com/drupal/node/5?q=node/11" title="14 oct. 2009"><strong>2009</strong></a>
               
               </td>
               <td class="c" id="displayYearEl" title="You are here: 20:27:14 août 15, 2011">2011</td>
	       <td class="f" nowrap="nowrap">
               
	           <a href="https://web.archive.org/web/20121011100953/http://www.fastcgi.com/drupal/node/5?q=node/11" title="11 oct. 2012"><strong>2012</strong></a>
	       
	       </td>
           </tr>
           </tbody></table>
       </td>
       </tr>
       <tr>
       <td class="s">
           <a class="t" href="https://web.archive.org/web/20110815202714*/http://www.fastcgi.com/drupal/node/5?q=node/11" title="See a list of every capture for this URL">17 captures</a>
           <div class="r" title="Timespan for captures of this URL">14 oct. 09 - 23 mars 16</div>
       </td>
       <td class="k">
       <a href="https://web.archive.org/web/20120715000000/http://www.fastcgi.com/drupal/node/5?q=node/11" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" title="Explore captures for this URL">
	 <img id="sparklineImgId" alt="sparklines" onmouseover="__wm.st(1)" onmouseout="__wm.st(0)" onmousemove="__wm.mv(event,this)" width="525" height="27" border="0" src="./Perl _ FastCGI -_files/graph.jsp">
       <div class="yt" style="display: none; width: 25px; height: 27px; left: 400px;"></div><div class="mt" style="display: none; width: 2px; height: 27px; left: 413px;"></div></div>
       </a>
       </td>
       </tr></tbody></table>
   </td>
   <td class="r">
       <a href="https://web.archive.org/web/20110815202714/http://www.fastcgi.com/drupal/node/5?q=node/11#close" onclick="__wm.h();return false;" style="background-image:url(/static/images/toolbar/wm_tb_close.png);top:5px;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="background-image:url(/static/images/toolbar/wm_tb_help.png);bottom:5px;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>
</div>
</div>
</div>


<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script type="text/javascript" src="./Perl _ FastCGI -_files/disclaim-element.js"></script>
<script type="text/javascript" src="./Perl _ FastCGI -_files/graph-calc.js"></script>
<script type="text/javascript">//<![CDATA[
var __wm = (function(imgWidth,imgHeight,yearImgWidth,monthImgWidth){
var wbPrefix = "/web/";
var wbCurrentUrl = "http://www.fastcgi.com/drupal/node/5?q=node/11";

var firstYear = 1996;
var displayDay = "15";
var displayMonth = "août";
var displayYear = "2011";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var $D=document,$=function(n){return document.getElementById(n)};
var trackerVal,curYear = -1,curMonth = -1;
var yearTracker,monthTracker;
function showTrackers(val) {
  if (val===trackerVal) return;
  var $ipp=$("wm-ipp");
  var $y=$("displayYearEl"),$m=$("displayMonthEl"),$d=$("displayDayEl");
  if (val) {
    $ipp.className="hi";
  } else {
    $ipp.className="";
    $y.innerHTML=displayYear;$m.innerHTML=displayMonth;$d.innerHTML=displayDay;
  }
  yearTracker.style.display=val?"inline":"none";
  monthTracker.style.display=val?"inline":"none";
  trackerVal = val;
}
function trackMouseMove(event,element) {
  var eventX = getEventX(event);
  var elementX = getElementX(element);
  var xOff = Math.min(Math.max(0, eventX - elementX),imgWidth);
  var monthOff = xOff % yearImgWidth;

  var year = Math.floor(xOff / yearImgWidth);
  var monthOfYear = Math.min(11,Math.floor(monthOff / monthImgWidth));
  // 1 extra border pixel at the left edge of the year:
  var month = (year * 12) + monthOfYear;
  var day = monthOff % 2==1?15:1;
  var dateString = zeroPad(year + firstYear) + zeroPad(monthOfYear+1,2) +
    zeroPad(day,2) + "000000";

  $("displayYearEl").innerHTML=year+firstYear;
  $("displayMonthEl").innerHTML=prettyMonths[monthOfYear];
  // looks too jarring when it changes..
  //$("displayDayEl").innerHTML=zeroPad(day,2);
  var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
  $("wm-graph-anchor").href=url;

  if(curYear != year) {
    var yrOff = year * yearImgWidth;
    yearTracker.style.left = yrOff + "px";
    curYear = year;
  }
  if(curMonth != month) {
    var mtOff = year + (month * monthImgWidth) + 1;
    monthTracker.style.left = mtOff + "px";
    curMonth = month;
  }
}
function hideToolbar() {
  $("wm-ipp").style.display="none";
}
function bootstrap() {
  var $spk=$("wm-ipp-sparkline");
  yearTracker=$D.createElement('div');
  yearTracker.className='yt';
  with(yearTracker.style){
    display='none';width=yearImgWidth+"px";height=imgHeight+"px";
  }
  monthTracker=$D.createElement('div');
  monthTracker.className='mt';
  with(monthTracker.style){
    display='none';width=monthImgWidth+"px";height=imgHeight+"px";
  }
  $spk.appendChild(yearTracker);
  $spk.appendChild(monthTracker);

  var $ipp=$("wm-ipp");
  $ipp&&disclaimElement($ipp);
}
return{st:showTrackers,mv:trackMouseMove,h:hideToolbar,bt:bootstrap};
})(525, 27, 25, 2);//]]>
</script>
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  min-width:800px !important;
}
</style>

<script type="text/javascript">__wm.bt();</script>
<!-- END WAYBACK TOOLBAR INSERT -->





<div id="wrapper">
	<div id="logo"></div>
	<div id="nav">
		<ul class="nav-links primary-nav-links"><li class="menu-49 first"><a href="https://web.archive.org/web/20110815202714/http://www.fastcgi.com/drupal/node/2">FastCGI</a></li>
<li class="menu-53"><a href="https://web.archive.org/web/20110815202714/http://www.fastcgi.com/drupal/node/19">News</a></li>
<li class="menu-45"><a href="https://web.archive.org/web/20110815202714/http://www.fastcgi.com/drupal/node/6">Documentation</a></li>
<li class="menu-44"><a href="https://web.archive.org/web/20110815202714/http://www.fastcgi.com/drupal/node/5">API/Libraries</a></li>
<li class="menu-43"><a href="https://web.archive.org/web/20110815202714/http://www.fastcgi.com/drupal/node/3">FastCGI Servers</a></li>
<li class="menu-46"><a href="https://web.archive.org/web/20110815202714/http://www.fastcgi.com/drupal/node/7">Misc.</a></li>
<li class="menu-48"><a href="https://web.archive.org/web/20110815202714/http://www.fastcgi.com/drupal/node/12">Help!</a></li>
<li class="menu-47 last"><a href="https://web.archive.org/web/20110815202714/http://www.fastcgi.com/drupal/node/8">About Us</a></li>
</ul>		</div>
	<div id="heading">
		Perl	</div> <!-- end heading -->
	<div id="content">
												<div id="node-11" class="node">



  
  <div class="content">
    <a name="PerlSignals">How do I handle signals in Perl?</a>

There is a problem when Apache httpd terminates. Apache will send a USR1 or TERM signal. The Perl 5.8 (with safe signal handling) FastCGI application receives the signal, but defers the signal till the next op-code break.  Apache then exits. The FastCGI application then continues waiting for a request that will never come.  If such a request could come, then the signal would be handled after the system call.  However, since a request can never come the FastCGI application hangs.
The closest, but maybe not the best solution I found was to set this ENV var.

FastCgiConfig -initial-env PERL_SIGNALS=unsafe

This allows the signals to be processed immediately.

Here's an example that ignores SIGPIPE:
<pre>#!/usr/local/bin/perl
use strict;
use warnings;

use FCGI;

my $count = 0;
my $handling_request = 0;
my $exit_requested = 0;

my $request = FCGI::Request();

sub sig_handler {
    $exit_requested = 1;
    exit(0) if !$handling_request;
}

$SIG{USR1} = \&amp;sig_handler;
$SIG{TERM} = \&amp;sig_handler;
$SIG{PIPE} = 'IGNORE';

while ($handling_request = ($request-&gt;Accept() &gt;= 0)) {
    &amp;do_request;
    
    $handling_request = 0;
    last if $exit_requested;
}

$request-&gt;Finish();

exit(0);

sub do_request() {
    print("Content-type: text/html\r\n\r\n", ++$count);
    $request-&gt;Finish();
}
</pre> 

<p>Here's an example that handles SIGPIPE in order to abort the request as quickly as possible:</p>

<pre>#!/usr/local/bin/perl
use strict;
use warnings;

use FCGI;

my $count = 0;
my $handling_request = 0;
my $exit_requested = 0;

my $request = FCGI::Request();

sub sig_handler {
    $exit_requested = 1;
    exit(0) if !$handling_request;
}

$SIG{USR1} = \&amp;sig_handler;

$SIG{TERM} = \&amp;sig_handler;
$SIG{PIPE} = sub {die 'SIGPIPE\n';};

while ($handling_request = ($request-&gt;Accept() &gt;= 0)) {
    eval {&amp;abort_request;} if (!eval {&amp;do_request; 1;} &amp;&amp; $@ ne 'SIGPIPE\n');
    
    $handling_request = 0;
    last if $exit_requested;
}

$request-&gt;Finish();

exit(0);

sub do_request() {
    print("Content-type: text/html\r\n\r\n", ++$count);
    $request-&gt;Finish();
}

sub abort_request() {
    $exit_requested = 1; # assume the error isn't recoverable
    print STDERR "fatal error, request aborted, shutting down: $@\n";
    
    $request-&gt;Finish();
}
</pre> 

<a name="Perlfork">How do I use fork or exec ?</a>

<p>When a request handle object is destroyed that has accepted a connection without finishing it, the connection will automatically be finished. Usually, this is what you want, although it is preferable to explicitly call the Finish() method. When you fork, however, without calling exec as well, i.e. when you have two instance of perl running, the request handle object will (eventually) be destroyed in <em>both</em> instances of perl. As a result, a possible request being handled will be finished when the object is destroyed for the first time. This is probably not what you expect, since you will usually only be handling the request in either the parent or the child. To inhibit this unwanted request finishing, you can send the Detach() message to the request handle object. In a detached state, destruction will not lead to any finishing of requests. It is advised you call Detach() before forking and Attach afterwards (in the process that will continue handling the request).</p> 
<p>Before doing this though, please think about whether or not you really need to fork inside the accept loop. Since the FastCGI paradigm is different from the normal CGI one, you'll find that there are situations where you would fork in a CGI context, whereas it may not be necessary in a FastCGI context. In other cases, you're better off doing the forking before the accept loop.</p> 
<p>Conversely, when you call exec without forking, the object will not be destroyed and no connection will automatically be finished, so in that case you are forced to do it yourself.</p>
<pre>#!/usr/bin/perl 
use strict;
use warnings;

use FCGI;

my $request = FCGI::Request();

while ($request-&gt;Accept() &gt;= 0) {
    # do stuff with $request
        
    $request-&gt;Detach();
    
    my $child;
    $child = fork;
    
    if (!defined $child) {
        # error handling
    } elsif ($child == 0) {
        # do child stuff
    }
    
    $request-&gt;Attach();
    
    # continue processing request
    
    $request-&gt;Finish();
}
</pre> 
<a name="perl_application_reload"></a>How can I get my application to reload when a new version is available?
Mod_perl has Apache::Reload, and Apache::StatINC. Is there a similar mechanism for FastCGI?

Assuming the application will automatically be restarted by mod_fastcgi (or another process manager), putting
something like this at the end of your request loop should do it.

<pre> 
while ( $request-&gt;Accept() &gt;= 0) {
    # handle request
    
    request-&gt;Finish();
    exit if -M $ENV{SCRIPT_FILENAME} &lt; 0; # Autorestart

}
</pre> 
  </div>

  <div class="clear-block clear">
    <div class="meta">
    
    </div>

      </div>

</div>	</div> <!-- end content -->
	<div id="footer">
		© Copyright 1996 - 2008 Open Market, Rob Saccoccio &amp; others, All rights reserved. <a href="https://web.archive.org/web/20110815202714/http://www.cosmicsitedesign.com/">Web design</a> by CosmicSiteDesign.com
	</div> <!-- end footer -->
</div> <!-- end wrapper -->








<!--
     FILE ARCHIVED ON 20:27:14 août 15, 2011 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 15:56:54 avr. 10, 2016.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
</body></html>